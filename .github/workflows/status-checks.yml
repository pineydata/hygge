name: Status Checks

on:
  pull_request:
    types: [opened, synchronize, reopened]

jobs:
  status-check:
    runs-on: ubuntu-latest
    if: github.event.pull_request.draft == false

    steps:
    - uses: actions/checkout@v4

    - name: Check test coverage
      run: |
        pip install -r requirements.txt
        pytest tests/ --cov=src/hygge --cov-report=term
        coverage report --fail-under=85

    - name: Validate commit messages follow TDD
      run: |
        # Check if commit message indicates tests were written
        if ! git log -1 --pretty=%B | grep -E "(test|fix|feat).*test"; then
          echo "❌ Commit message should indicate tests were written"
          echo "Examples: 'feat: add new feature with tests' or 'fix: resolve issue and add tests'"
          exit 1
        else
          echo "✅ Commit message follows TDD conventions"
        fi
