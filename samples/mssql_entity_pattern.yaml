# MS SQL Server Entity Pattern
#
# This example shows the entity pattern - extracting multiple tables
# from SQL Server using a single flow definition and connection pool.
#
# Perfect for extracting many tables (10s, 100s, 200+) efficiently
# with connection reuse across all entities.
#
# Prerequisites:
# - ODBC Driver 18 for SQL Server installed
# - Azure AD authentication configured (Azure CLI or Managed Identity)
# - Appropriate permissions on the SQL Server database

connections:
  salesforce_replica:
    type: mssql
    server: ${SQL_SERVER}  # Use environment variables for sensitive data
    database: ${SQL_DATABASE}
    pool_size: 8  # Limit concurrent extractions (prevents connection exhaustion)

flows:
  salesforce_to_lake:
    home:
      type: mssql
      connection: salesforce_replica

      # No table specified - each entity defines its table name
      # Alternatively, use table: "dbo.{entity}" for dynamic substitution

    store:
      type: parquet
      path: data/salesforce  # Base path - each entity gets subdirectory

    # Entity pattern - one flow execution per entity
    # Each entity gets its own subdirectory: data/salesforce/{entity}/
    entities:
      - Account
      - Contact
      - Opportunity
      - Lead
      - Case
      - Task
      - Event
      - User
      - Campaign
      - Product2

# How it works:
# 1. Coordinator creates connection pool with 8 connections
# 2. Creates one flow per entity (10 flows total)
# 3. Runs flows in parallel, each acquiring/releasing connections from pool
# 4. Data structure: data/salesforce/Account/, data/salesforce/Contact/, etc.
#
# Scaling:
# - For 50 tables: Set pool_size to 5-10
# - For 200 tables: Set pool_size to 8-12 (balance parallelism vs. connection limits)
# - Monitor SQL Server connection count to tune pool_size
